===============================================================================
                    äº”å­æ£‹æ¸¸æˆè½¯ä»¶æºä»£ç ï¼ˆå‰30é¡µï¼‰
===============================================================================
è½¯ä»¶åç§°ï¼šFiveInRowäº’åŠ¨äº”å­æ£‹
ç‰ˆæœ¬å·ï¼šv1.0.0
å¼€å‘è€…ï¼šé™ˆäº‘äº®
é‚®ç®±ï¼š676814828@qq.com
å¼€å‘æ—¥æœŸï¼š2025å¹´12æœˆ
===============================================================================

æœ¬æ–‡æ¡£åŒ…å«è½¯ä»¶æºä»£ç çš„å‰30é¡µå†…å®¹ï¼ŒæŒ‰ç…§æ–‡ä»¶é¡ºåºå±•ç¤ºæ ¸å¿ƒä»£ç å®ç°ã€‚

===============================================================================
ç¬¬1é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/pages/Index.ets
æ–‡ä»¶è¯´æ˜ï¼šäº”å­æ£‹æ¸¸æˆä¸»é¡µé¢ï¼Œå®ç°æ£‹ç›˜æ˜¾ç¤ºã€è½å­äº¤äº’ã€æ‚”æ£‹ã€èƒœè´Ÿåˆ¤å®šç­‰åŠŸèƒ½
-------------------------------------------------------------------------------

/**
 * äº”å­æ£‹æ¸¸æˆä¸»é¡µé¢
 * å®ç°æ£‹ç›˜æ˜¾ç¤ºã€è½å­äº¤äº’ã€æ‚”æ£‹ã€èƒœè´Ÿåˆ¤å®šç­‰åŠŸèƒ½
 */

import { PieceType, GameStatus, DEFAULT_CONFIG, CONFIG_30X30 } from '../model/GameTypes';
import { GameState } from '../model/GameState';
import { AudioManager } from '../model/AudioManager';
import { APP_INFO, BOARD_LAYOUT, SCALE_CONFIG, isStarPoint, getIndices } from '../model/GameConstants';
import { hilog } from '@kit.PerformanceAnalysisKit';

// ç¤¼èŠ±ç²’å­æ¥å£
interface ConfettiItem {
  id: number;
  x: number;      // æ°´å¹³ä½ç½® vp
  y: number;      // å‚ç›´ä½ç½® vp
  speedY: number; // ä¸‹è½é€Ÿåº¦
  speedX: number; // æ°´å¹³æ‘‡æ‘†é€Ÿåº¦
  color: string;
  size: number;
  rotation: number;
  rotationSpeed: number;
  symbol: string;
}

@Entry
@Component
struct Index {
  // æ¸¸æˆçŠ¶æ€ç®¡ç†
  private gameState: GameState = new GameState(DEFAULT_CONFIG);
  private audioManager: AudioManager = AudioManager.getInstance();

  // UIå“åº”å¼çŠ¶æ€
  @State boardData: PieceType[][] = [];
  @State currentPlayer: PieceType = PieceType.BLACK;
  @State gameStatus: GameStatus = GameStatus.PLAYING;
  @State lastMoveRow: number = -1;
  @State lastMoveCol: number = -1;
  @State totalMoves: number = 0;
  @State selectedBoardSize: number = 15;

===============================================================================
ç¬¬2é¡µ
===============================================================================

  @State boardSize: number = 15;
  @State cellSize: number = BOARD_LAYOUT.board15.cellSize;
  @State pieceSize: number = BOARD_LAYOUT.board15.pieceSize;
  @State isMaximized: boolean = false;
  @State soundEnabled: boolean = true;

  // åº†ç¥åŠ¨ç”»çŠ¶æ€
  @State showCelebration: boolean = false;
  @State celebrationText: string = '';
  @State winnerText: string = '';
  @State confettiItems: ConfettiItem[] = [];
  @State animationTick: number = 0; // åŠ¨ç”»å¸§è®¡æ•°å™¨
  @State screenWidth: number = 400;  // å±å¹•å®½åº¦ï¼ŒåŠ¨æ€è·å–
  @State screenHeight: number = 800; // å±å¹•é«˜åº¦ï¼ŒåŠ¨æ€è·å–
  private celebrationTimer: number = -1;
  private animationTimer: number = -1;

  // å¤¸å¥–è¯­åˆ—è¡¨
  private readonly praises: string[] = [
    'çœŸæ£’ï¼ğŸ‰',
    'å¤ªå‰å®³äº†ï¼ğŸ‘',
    'ç¥ä¹å…¶æŠ€ï¼âœ¨',
    'æ— äººèƒ½æ•Œï¼ğŸ’ª',
    'æ£‹è‰ºè¶…ç¾¤ï¼ğŸ†',
    'å®Œç¾èƒœåˆ©ï¼ğŸŒŸ',
    'å¤©æ‰æ£‹æ‰‹ï¼ğŸ§ ',
    'å®åŠ›è¶…ç¾¤ï¼ğŸ”¥',
    'æˆ˜æ— ä¸èƒœï¼âš”ï¸',
    'éœ¸æ°”åè¶³ï¼ğŸ‘‘',
    'é«˜æ‰‹å¦‚äº‘ï¼â˜ï¸',
    'æŠ€æƒŠå››åº§ï¼ğŸŒ'
  ];

  // ç¼©æ”¾ç›¸å…³çŠ¶æ€ï¼ˆæœ€å¤§åŒ–æ¨¡å¼ä½¿ç”¨ï¼‰
  @State scaleValue: number = 1;
  @State pinchValue: number = 1;
  @State minScale: number = 1.0;
  @State maxScale: number = 2.0;

  // æ‹–åŠ¨ç›¸å…³çŠ¶æ€ï¼ˆæœ€å¤§åŒ–æ¨¡å¼ä½¿ç”¨ï¼‰
  @State offsetX: number = 0;
  @State offsetY: number = 0;
  private panOffsetX: number = 0;
  private panOffsetY: number = 0;

===============================================================================
ç¬¬3é¡µ
===============================================================================

  aboutToAppear(): void {
    this.syncState();
    // è·å– Context å¹¶åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨
    const context = getContext(this);
    this.audioManager.setContext(context);
    this.audioManager.initialize();
  }

  aboutToDisappear(): void {
    this.audioManager.release();
  }

  /**
   * åŒæ­¥æ¸¸æˆçŠ¶æ€åˆ°UI
   */
  private syncState(): void {
    const previousStatus = this.gameStatus;
    
    this.boardData = this.gameState.getBoard();
    this.currentPlayer = this.gameState.getCurrentPlayer();
    this.gameStatus = this.gameState.getGameStatus();
    this.totalMoves = this.gameState.getTotalMoves();

    const lastMove = this.gameState.getLastMove();
    if (lastMove) {
      this.lastMoveRow = lastMove.row;
      this.lastMoveCol = lastMove.col;
    } else {
      this.lastMoveRow = -1;
      this.lastMoveCol = -1;
    }

    // æ£€æµ‹æ˜¯å¦åˆšåˆšè·èƒœï¼Œè§¦å‘åº†ç¥åŠ¨ç”»
    if (previousStatus === GameStatus.PLAYING) {
      if (this.gameStatus === GameStatus.BLACK_WIN) {
        this.triggerCelebration(true);
      } else if (this.gameStatus === GameStatus.WHITE_WIN) {
        this.triggerCelebration(false);
      }
    }
  }

  /**
   * å¤„ç†è½å­äº‹ä»¶
   */
  private handleCellClick(row: number, col: number): void {
    hilog.info(0x0000, 'GamePlay', `Cell clicked: row=${row}, col=${col}`);

    const currentPieceType = this.currentPlayer;

===============================================================================
ç¬¬4é¡µ
===============================================================================

    if (this.gameState.placePiece(row, col)) {
      hilog.info(0x0000, 'GamePlay', `Piece placed at (${row}, ${col})`);
      if (this.soundEnabled) {
        this.audioManager.playPieceSound(currentPieceType);
      }
      this.syncState();
    }
  }

  /**
   * å¤„ç†æ‚”æ£‹äº‹ä»¶
   */
  private handleUndo(): void {
    if (this.gameState.undo()) {
      hilog.info(0x0000, 'GamePlay', 'Undo successful');
      this.syncState();
    }
  }

  /**
   * å¤„ç†é‡æ–°å¼€å§‹äº‹ä»¶
   */
  private handleRestart(): void {
    this.closeCelebration();
    this.gameState.reset();
    this.syncState();
    hilog.info(0x0000, 'GamePlay', 'Game reset');
  }

  /**
   * è§¦å‘åº†ç¥åŠ¨ç”»
   */
  private triggerCelebration(isBlackWin: boolean): void {
    // è®¾ç½®è·èƒœè€…æ–‡æœ¬
    this.winnerText = isBlackWin ? 'â¬› é»‘æ–¹è·èƒœï¼' : 'â¬œ ç™½æ–¹è·èƒœï¼';
    
    // éšæœºé€‰æ‹©å¤¸å¥–è¯­
    const randomIndex = Math.floor(Math.random() * this.praises.length);
    this.celebrationText = this.praises[randomIndex];
    
    // ç”Ÿæˆç¤¼èŠ±ç²’å­
    this.generateConfetti();
    
    // æ˜¾ç¤ºåº†ç¥å¼¹çª—
    this.showCelebration = true;
    
    // 5ç§’åè‡ªåŠ¨å…³é—­
    this.celebrationTimer = setTimeout(() => {
      this.showCelebration = false;
    }, 5000) as number;
  }

===============================================================================
ç¬¬5é¡µ
===============================================================================

  /**
   * ç”Ÿæˆç¤¼èŠ±ç²’å­
   */
  private generateConfetti(): void {
    const colors: string[] = [
      '#FFFF00', '#FF0000', '#00FF00', '#00FFFF', '#FF00FF',
      '#FFA500', '#FFEB3B', '#4CAF50', '#2196F3', '#E91E63',
      '#FF5722', '#8BC34A', '#03A9F4', '#9C27B0', '#FFCC00',
      '#00FF7F', '#FF1493', '#7FFF00', '#FF6347', '#40E0D0'
    ];
    const symbols: string[] = ['âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'ğŸŠ', 'ğŸ‰', 'ğŸ’', 'ğŸŒˆ', 'ğŸ”¥', 'ğŸ’¥', 'ğŸµ', 'ğŸ¶'];
    const items: ConfettiItem[] = [];
    
    const w = this.screenWidth > 0 ? this.screenWidth : 400;
    const h = this.screenHeight > 0 ? this.screenHeight : 800;
    
    // åˆ›å»ºç²’å­ï¼Œåˆå§‹åˆ†å¸ƒåœ¨ä¸åŒé«˜åº¦
    for (let i = 0; i < 50; i++) {
      items.push({
        id: i,
        x: Math.random() * w,
        y: Math.random() * h - 50,
        speedY: 2 + Math.random() * 4,
        speedX: (Math.random() - 0.5) * 2,
        color: colors[Math.floor(Math.random() * colors.length)],
        size: 22 + Math.random() * 22,
        rotation: Math.random() * 360,
        rotationSpeed: (Math.random() - 0.5) * 8,
        symbol: symbols[Math.floor(Math.random() * symbols.length)]
      });
    }
    
    this.confettiItems = items;
    this.animationTick = 0;
    this.startConfettiAnimation();
  }

  /**
   * å¯åŠ¨ç¤¼èŠ±åŠ¨ç”»
   */
  private startConfettiAnimation(): void {
    if (this.animationTimer !== -1) {
      clearInterval(this.animationTimer);
    }
    
    // 25fps åŠ¨ç”»
    this.animationTimer = setInterval(() => {
      const w = this.screenWidth > 0 ? this.screenWidth : 400;
      const h = this.screenHeight > 0 ? this.screenHeight : 800;

===============================================================================
ç¬¬6é¡µ
===============================================================================

      const items = this.confettiItems;
      for (let i = 0; i < items.length; i++) {
        items[i].y += items[i].speedY;
        items[i].x += items[i].speedX;
        items[i].rotation += items[i].rotationSpeed;
        
        // è½åˆ°åº•éƒ¨åé‡æ–°ä»é¡¶éƒ¨å¼€å§‹
        if (items[i].y > h + 30) {
          items[i].y = -30;
          items[i].x = Math.random() * w;
        }
        // æ°´å¹³è¾¹ç•Œ
        if (items[i].x < -20) items[i].x = w + 10;
        if (items[i].x > w + 20) items[i].x = -10;
      }
      // æ›´æ–° tick è§¦å‘ UI åˆ·æ–°
      this.animationTick++;
    }, 40) as number;
  }

  /**
   * é‡æ–°åˆ†å¸ƒç²’å­ä»¥è¦†ç›–æ•´ä¸ªå±å¹•
   */
  private redistributeConfetti(): void {
    const w = this.screenWidth;
    const h = this.screenHeight;
    const items = this.confettiItems;
    for (let i = 0; i < items.length; i++) {
      items[i].x = Math.random() * w;
      items[i].y = Math.random() * h - 50;
    }
  }

  /**
   * åœæ­¢ç¤¼èŠ±åŠ¨ç”»
   */
  private stopConfettiAnimation(): void {
    if (this.animationTimer !== -1) {
      clearInterval(this.animationTimer);
      this.animationTimer = -1;
    }
  }

  /**
   * å…³é—­åº†ç¥å¼¹çª—
   */
  private closeCelebration(): void {
    this.showCelebration = false;
    this.stopConfettiAnimation();

===============================================================================
ç¬¬7é¡µ
===============================================================================

    if (this.celebrationTimer !== -1) {
      clearTimeout(this.celebrationTimer);
      this.celebrationTimer = -1;
    }
  }

  /**
   * è·å–çŠ¶æ€æ–‡æœ¬
   */
  private getStatusText(): string {
    switch (this.gameStatus) {
      case GameStatus.BLACK_WIN:
        return 'é»‘æ–¹è·èƒœï¼';
      case GameStatus.WHITE_WIN:
        return 'ç™½æ–¹è·èƒœï¼';
      case GameStatus.DRAW:
        return 'å¹³å±€ï¼';
      default:
        return this.currentPlayer === PieceType.BLACK ? 'é»‘æ–¹å›åˆ' : 'ç™½æ–¹å›åˆ';
    }
  }

  /**
   * åˆ‡æ¢æ£‹ç›˜å°ºå¯¸
   */
  private switchBoardSize(size: number): void {
    if (size === this.boardSize) return;

    this.selectedBoardSize = size;
    this.boardSize = size;
    this.isMaximized = false;
    this.resetTransform();

    if (size === 30) {
      this.cellSize = BOARD_LAYOUT.board30.baseCellSize;
      this.pieceSize = BOARD_LAYOUT.board30.basePieceSize;
      this.gameState = new GameState(CONFIG_30X30);
    } else {
      this.cellSize = BOARD_LAYOUT.board15.cellSize;
      this.pieceSize = BOARD_LAYOUT.board15.pieceSize;
      this.gameState = new GameState(DEFAULT_CONFIG);
    }

    this.syncState();
    hilog.info(0x0000, 'GamePlay', `Board size changed to: ${size}`);
  }

===============================================================================
ç¬¬8é¡µ
===============================================================================

  /**
   * åˆ‡æ¢æœ€å¤§åŒ–æ¨¡å¼
   */
  private toggleMaximize(): void {
    this.isMaximized = !this.isMaximized;

    if (this.isMaximized) {
      const config = this.boardSize === 30 ? SCALE_CONFIG.scale30 : SCALE_CONFIG.scale15;
      this.scaleValue = config.defaultValue;
      this.minScale = config.min;
      this.maxScale = config.max;
      this.pinchValue = this.scaleValue;
    } else {
      this.resetTransform();
    }

    hilog.info(0x0000, 'GamePlay', `Maximize mode: ${this.isMaximized}`);
  }

  /**
   * é‡ç½®å˜æ¢çŠ¶æ€
   */
  private resetTransform(): void {
    this.scaleValue = 1;
    this.pinchValue = 1;
    this.offsetX = 0;
    this.offsetY = 0;
    this.panOffsetX = 0;
    this.panOffsetY = 0;
  }

  build() {
    Stack() {
      // ä¸»å†…å®¹
      Column() {
      // æ ‡é¢˜åŒºåŸŸï¼ˆéæœ€å¤§åŒ–æ¨¡å¼ï¼‰
      if (!this.isMaximized) {
        Text('FiveInRowäº’åŠ¨äº”å­æ£‹')
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
          .fontColor($r('app.color.primary_text'))
          .margin({ top: 20, bottom: 10 })

        // æ£‹ç›˜å°ºå¯¸é€‰æ‹©
        Row() {
          Text('æ£‹ç›˜å°ºå¯¸:')
            .fontSize(14)
            .fontColor($r('app.color.secondary_text'))
            .margin({ right: 10 })

===============================================================================
ç¬¬9é¡µ
===============================================================================

          Button('15Ã—15')
            .fontSize(14)
            .fontColor(this.selectedBoardSize === 15 ? $r('app.color.button_text') : $r('app.color.primary_text'))
            .backgroundColor(this.selectedBoardSize === 15 ? $r('app.color.button_primary') : '#E0E0E0')
            .width(80)
            .height(32)
            .borderRadius(16)
            .onClick(() => this.switchBoardSize(15))

          Button('30Ã—30')
            .fontSize(14)
            .fontColor(this.selectedBoardSize === 30 ? $r('app.color.button_text') : $r('app.color.primary_text'))
            .backgroundColor(this.selectedBoardSize === 30 ? $r('app.color.button_primary') : '#E0E0E0')
            .width(80)
            .height(32)
            .borderRadius(16)
            .margin({ left: 10 })
            .onClick(() => this.switchBoardSize(30))
        }
        .margin({ bottom: 5 })

        // æœ€å¤§åŒ–å’Œå£°éŸ³å¼€å…³
        Row() {
          Button('æœ€å¤§åŒ–')
            .fontSize(14)
            .fontColor($r('app.color.button_text'))
            .backgroundColor('#FF6B35')
            .width(80)
            .height(32)
            .borderRadius(16)
            .onClick(() => this.toggleMaximize())

          Button(this.soundEnabled ? 'å£°éŸ³ å¼€' : 'å£°éŸ³ å…³')
            .fontSize(14)
            .fontColor($r('app.color.button_text'))
            .backgroundColor(this.soundEnabled ? '#4CAF50' : '#9E9E9E')
            .width(80)
            .height(32)
            .borderRadius(16)
            .margin({ left: 10 })
            .onClick(() => {
              this.soundEnabled = !this.soundEnabled;
              this.audioManager.setSoundEnabled(this.soundEnabled);
            })
        }
        .margin({ bottom: 10 })

===============================================================================
ç¬¬10é¡µ
===============================================================================

        // çŠ¶æ€æ˜¾ç¤º
        Row() {
          if (this.gameStatus === GameStatus.PLAYING) {
            Circle({ width: 24, height: 24 })
              .fill(this.currentPlayer === PieceType.BLACK ?
                $r('app.color.black_turn_indicator') : $r('app.color.white_turn_indicator'))
              .stroke($r('app.color.board_line'))
              .strokeWidth(1)
              .margin({ right: 8 })
          }

          Text(this.getStatusText())
            .fontSize(20)
            .fontWeight(FontWeight.Medium)
            .fontColor(this.gameStatus !== GameStatus.PLAYING ?
              $r('app.color.win_color') : $r('app.color.primary_text'))
        }
        .margin({ bottom: 10 })

        Text(`æ€»æ­¥æ•°: ${this.totalMoves}`)
          .fontSize(14)
          .fontColor($r('app.color.secondary_text'))
          .margin({ bottom: this.boardSize === 30 ? 5 : 15 })
      }

      // æœ€å¤§åŒ–æ¨¡å¼ï¼šç®€åŒ–çŠ¶æ€æ 
      if (this.isMaximized) {
        Row() {
          Button('é€€å‡ºæœ€å¤§åŒ–')
            .fontSize(12)
            .fontColor($r('app.color.button_text'))
            .backgroundColor('#FF6B35')
            .height(28)
            .borderRadius(14)
            .margin({ right: 15 })
            .onClick(() => this.toggleMaximize())

          if (this.gameStatus === GameStatus.PLAYING) {
            Circle({ width: 20, height: 20 })
              .fill(this.currentPlayer === PieceType.BLACK ?
                $r('app.color.black_turn_indicator') : $r('app.color.white_turn_indicator'))
              .stroke($r('app.color.board_line'))
              .strokeWidth(1)
              .margin({ right: 6 })
          }

===============================================================================
ç¬¬11é¡µ
===============================================================================

          Text(this.getStatusText())
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor(this.gameStatus !== GameStatus.PLAYING ?
              $r('app.color.win_color') : $r('app.color.primary_text'))

          Text(` | ${(this.scaleValue * 100).toFixed(0)}%`)
            .fontSize(12)
            .fontColor($r('app.color.secondary_text'))
            .margin({ left: 10 })

          Text(' | åŒæŒ‡ç¼©æ”¾/ä¸‰æŒ‡ç§»åŠ¨')
            .fontSize(11)
            .fontColor('#888888')
            .margin({ left: 8 })
        }
        .margin({ top: 0, bottom: 0 })
      }

      // éæœ€å¤§åŒ–30è·¯ç¼©æ”¾æç¤º
      if (!this.isMaximized && this.boardSize === 30) {
        Text(`åŒæŒ‡ç¼©æ”¾: ${(this.scaleValue * 100).toFixed(0)}% | æ”¯æŒä¸‰æŒ‡æ‹–æ‹½ç§»åŠ¨`)
          .fontSize(12)
          .fontColor($r('app.color.secondary_text'))
          .margin({ bottom: 10 })
      }

      // æ£‹ç›˜åŒºåŸŸ
      if (this.isMaximized || this.boardSize === 30) {
        this.ScalableBoard()
      } else {
        this.StaticBoard()
      }

      // æ“ä½œæŒ‰é’®
      Row() {
        Button('æ‚”æ£‹')
          .fontSize(this.isMaximized ? 14 : 16)
          .fontColor($r('app.color.button_text'))
          .backgroundColor($r('app.color.button_secondary'))
          .width(this.isMaximized ? 80 : 100)
          .height(this.isMaximized ? 36 : 44)
          .borderRadius(this.isMaximized ? 18 : 22)
          .enabled(this.totalMoves > 0 && this.gameStatus === GameStatus.PLAYING)
          .opacity(this.totalMoves > 0 && this.gameStatus === GameStatus.PLAYING ? 1 : 0.5)
          .onClick(() => this.handleUndo())

===============================================================================
ç¬¬12é¡µ
===============================================================================

        Button('é‡æ–°å¼€å§‹')
          .fontSize(this.isMaximized ? 14 : 16)
          .fontColor($r('app.color.button_text'))
          .backgroundColor($r('app.color.button_primary'))
          .width(this.isMaximized ? 100 : 120)
          .height(this.isMaximized ? 36 : 44)
          .borderRadius(this.isMaximized ? 18 : 22)
          .margin({ left: 20 })
          .enabled(this.totalMoves > 0)
          .opacity(this.totalMoves > 0 ? 1 : 0.5)
          .onClick(() => this.handleRestart())
      }
      .margin({ bottom: this.isMaximized ? 0 : (this.boardSize === 30 ? 10 : 20) })

      // ç‰ˆæœ¬ä¿¡æ¯ï¼ˆéæœ€å¤§åŒ–æ¨¡å¼ï¼‰
      if (!this.isMaximized) {
        Column() {
          Text(`v${APP_INFO.version}`)
            .fontSize(12)
            .fontColor($r('app.color.secondary_text'))
            .margin({ bottom: 4 })

          Text(`ä½œè€…: ${APP_INFO.author}`)
            .fontSize(11)
            .fontColor($r('app.color.secondary_text'))
            .margin({ bottom: 2 })

          Text(APP_INFO.email)
            .fontSize(10)
            .fontColor($r('app.color.secondary_text'))
        }
        .margin({ bottom: this.boardSize === 30 ? 10 : 15 })
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.page_background'))
    .justifyContent(FlexAlign.Start)
    .alignItems(HorizontalAlign.Center)

      // åº†ç¥å¼¹çª—å±‚
      if (this.showCelebration) {
        Column() {
          // ç¤¼èŠ±ç²’å­å±‚ - ä½¿ç”¨ animationTick è§¦å‘é‡ç»˜
          Stack() {

===============================================================================
ç¬¬13é¡µ
===============================================================================

            ForEach(this.confettiItems, (item: ConfettiItem) => {
              Text(item.symbol)
                .fontSize(item.size)
                .fontColor(item.color)
                .rotate({ angle: item.rotation })
                .shadow({ radius: 8, color: item.color, offsetX: 0, offsetY: 0 })
                .position({ x: item.x + this.animationTick * 0, y: item.y })
            }, (item: ConfettiItem) => `${item.id}_${this.animationTick}`)
          }
          .width('100%')
          .height('100%')
          .clip(true)
          .onAreaChange((_oldArea: Area, newArea: Area) => {
            // åŠ¨æ€è·å–å®é™…å±å¹•å°ºå¯¸
            const newWidth = Number(newArea.width);
            const newHeight = Number(newArea.height);
            if (newWidth > 0 && newHeight > 0) {
              if (this.screenWidth !== newWidth || this.screenHeight !== newHeight) {
                this.screenWidth = newWidth;
                this.screenHeight = newHeight;
                // é‡æ–°åˆ†å¸ƒç²’å­ä»¥è¦†ç›–æ•´ä¸ªå±å¹•
                this.redistributeConfetti();
              }
            }
          })

          // ä¸­å¿ƒå†…å®¹å¡ç‰‡
          Column() {
            // çš‡å† è£…é¥°
            Text('ğŸ‘‘')
              .fontSize(60)
              .margin({ bottom: 10 })

            // è·èƒœè€…æ–‡æœ¬
            Text(this.winnerText)
              .fontSize(36)
              .fontWeight(FontWeight.Bold)
              .fontColor('#00FFFF')
              .margin({ bottom: 16 })
              .textShadow({ radius: 20, color: '#00CED1', offsetX: 0, offsetY: 0 })

            // å¤¸å¥–è¯­
            Text(this.celebrationText)
              .fontSize(48)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FFFF00')
              .margin({ bottom: 24 })
              .textShadow({ radius: 25, color: '#FFA500', offsetX: 0, offsetY: 0 })

===============================================================================
ç¬¬14é¡µ
===============================================================================

            // è£…é¥°åˆ†å‰²çº¿
            Row() {
              Text('âœ¦').fontSize(16).fontColor('#FFFF00')
              Row().width(80).height(2).backgroundColor('#FFFF00').margin({ left: 8, right: 8 })
              Text('âœ¦').fontSize(16).fontColor('#FFFF00')
            }
            .margin({ bottom: 20 })

            // æç¤ºæ–‡å­—
            Text('ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­')
              .fontSize(14)
              .fontColor('#AAAAAA')
          }
          .width('85%')
          .padding({ top: 30, bottom: 30, left: 30, right: 30 })
          .backgroundColor('#AA2D1B4E')
          .borderRadius(28)
          .border({ width: 2, color: '#FFFF00' })
          .shadow({ radius: 40, color: '#000000', offsetX: 0, offsetY: 15 })
          .position({ x: '7.5%', y: '25%' })
          .hitTestBehavior(HitTestMode.Block)
          .onClick(() => {
            this.closeCelebration();
          })
        }
        .width('100%')
        .height('100%')
        .backgroundColor('#88000000')
        .onClick(() => this.closeCelebration())
      }
    }
    .width('100%')
    .height('100%')
  }

  /**
   * å¯ç¼©æ”¾æ£‹ç›˜ï¼ˆæœ€å¤§åŒ–æˆ–30è·¯ï¼‰
   */
  @Builder
  ScalableBoard() {
    Stack() {
      Column() {
        ForEach(getIndices(this.boardSize), (row: number) => {
          Row() {
            ForEach(getIndices(this.boardSize), (col: number) => {
              this.BoardCell(row, col)
            })
          }
        })
      }

===============================================================================
ç¬¬15é¡µ
===============================================================================

      .backgroundColor($r('app.color.board_background'))
      .padding(BOARD_LAYOUT.padding)
      .borderRadius(8)
      .shadow({ radius: 10, color: '#33000000', offsetX: 2, offsetY: 4 })
      .scale({ x: this.scaleValue, y: this.scaleValue })
      .translate({ x: this.offsetX, y: this.offsetY })
    }
    .width('100%')
    .height('100%')
    .clip(true)
    .gesture(
      GestureGroup(GestureMode.Exclusive,
        // ä¸‰æŒ‡ç§»åŠ¨æ‰‹åŠ¿ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼Œæ”¾åœ¨å‰é¢ï¼‰
        PanGesture({ fingers: 3, direction: PanDirection.All })
          .onActionStart(() => {
            this.panOffsetX = this.offsetX;
            this.panOffsetY = this.offsetY;
          })
          .onActionUpdate((event: GestureEvent) => {
            if (event) {
              this.offsetX = this.panOffsetX + (event.offsetX || 0);
              this.offsetY = this.panOffsetY + (event.offsetY || 0);
            }
          })
          .onActionEnd(() => {
            this.panOffsetX = this.offsetX;
            this.panOffsetY = this.offsetY;
          }),
        // åŒæŒ‡ç¼©æ”¾æ‰‹åŠ¿
        PinchGesture({ fingers: 2 })
          .onActionStart(() => { this.pinchValue = this.scaleValue; })
          .onActionUpdate((event: GestureEvent) => {
            if (event?.scale) {
              const config = this.boardSize === 30 ? SCALE_CONFIG.scale30 : SCALE_CONFIG.scale15;
              let newScale = this.pinchValue * event.scale;
              this.scaleValue = Math.max(config.min, Math.min(config.max, newScale));
            }
          })
          .onActionEnd(() => { this.pinchValue = this.scaleValue; })
      )
    )
    .layoutWeight(1)
    .margin({ bottom: this.isMaximized ? 0 : 10 })
  }

===============================================================================
ç¬¬16é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/model/GameLogic.ets
æ–‡ä»¶è¯´æ˜ï¼šäº”å­æ£‹æ¸¸æˆé€»è¾‘æ¨¡å—ï¼ŒåŒ…å«èƒœè´Ÿåˆ¤å®šã€è§„åˆ™æ£€æŸ¥ç­‰æ ¸å¿ƒç®—æ³•
-------------------------------------------------------------------------------

/**
 * äº”å­æ£‹æ¸¸æˆé€»è¾‘æ¨¡å—
 * åŒ…å«èƒœè´Ÿåˆ¤å®šã€è§„åˆ™æ£€æŸ¥ç­‰æ ¸å¿ƒç®—æ³•
 * æ‰€æœ‰ç®—æ³•ä»¥æœ€åè½å­ç‚¹ä¸ºä¸­å¿ƒï¼Œå¤æ‚åº¦æ¥è¿‘ O(1)
 */

import { PieceType, GameStatus, Position, DIRECTIONS, GameConfig, DEFAULT_CONFIG } from './GameTypes';

/**
 * æ¸¸æˆé€»è¾‘ç±»
 * è´Ÿè´£è§„åˆ™éªŒè¯å’Œèƒœè´Ÿåˆ¤å®š
 */
export class GameLogic {
  private config: GameConfig;

  constructor(config: GameConfig = DEFAULT_CONFIG) {
    this.config = config;
  }

  /**
   * æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨æ£‹ç›˜èŒƒå›´å†…
   */
  isValidPosition(row: number, col: number): boolean {
    return row >= 0 && row < this.config.boardSize &&
           col >= 0 && col < this.config.boardSize;
  }

  /**
   * æ£€æŸ¥æŒ‡å®šä½ç½®æ˜¯å¦å¯ä»¥è½å­
   * @param board å½“å‰æ£‹ç›˜çŠ¶æ€
   * @param row è¡Œç´¢å¼•
   * @param col åˆ—ç´¢å¼•
   */
  canPlacePiece(board: PieceType[][], row: number, col: number): boolean {
    if (!this.isValidPosition(row, col)) {
      return false;
    }
    return board[row][col] === PieceType.EMPTY;
  }

===============================================================================
ç¬¬17é¡µ
===============================================================================

  /**
   * åœ¨æŒ‡å®šæ–¹å‘ä¸Šè®¡ç®—è¿ç»­åŒè‰²æ£‹å­æ•°é‡
   * @param board æ£‹ç›˜çŠ¶æ€
   * @param row èµ·å§‹è¡Œ
   * @param col èµ·å§‹åˆ—
   * @param piece æ£‹å­ç±»å‹
   * @param direction æ–¹å‘å‘é‡
   * @returns è¯¥æ–¹å‘ä¸Šè¿ç»­åŒè‰²æ£‹å­æ•°é‡ï¼ˆä¸å«èµ·ç‚¹ï¼‰
   */
  private countInDirection(
    board: PieceType[][],
    row: number,
    col: number,
    piece: PieceType,
    direction: Position
  ): number {
    let count = 0;
    let currentRow = row + direction.row;
    let currentCol = col + direction.col;

    while (this.isValidPosition(currentRow, currentCol) &&
           board[currentRow][currentCol] === piece) {
      count++;
      currentRow += direction.row;
      currentCol += direction.col;
    }

    return count;
  }

  /**
   * æ£€æŸ¥æŒ‡å®šä½ç½®æ˜¯å¦å½¢æˆè·èƒœè¿çº¿
   * ä»¥æœ€åè½å­ç‚¹ä¸ºä¸­å¿ƒï¼Œå‘4ä¸ªæ–¹å‘åŒå‘æ‰©å±•
   * å¤æ‚åº¦: O(4 * winCondition) â‰ˆ O(1)
   *
   * @param board æ£‹ç›˜çŠ¶æ€
   * @param row æœ€åè½å­è¡Œ
   * @param col æœ€åè½å­åˆ—
   * @returns æ˜¯å¦è·èƒœ
   */
  checkWin(board: PieceType[][], row: number, col: number): boolean {
    const piece = board[row][col];
    if (piece === PieceType.EMPTY) {
      return false;
    }

    // æ£€æŸ¥4ä¸ªæ–¹å‘
    for (const direction of DIRECTIONS) {
      // æ­£å‘è®¡æ•°
      const positiveCount = this.countInDirection(board, row, col, piece, direction);
      // åå‘è®¡æ•°ï¼ˆæ–¹å‘å–åï¼‰
      const negativeDirection: Position = {
        row: -direction.row,
        col: -direction.col
      };

===============================================================================
ç¬¬18é¡µ
===============================================================================

      const negativeCount = this.countInDirection(board, row, col, piece, negativeDirection);

      // æ€»æ•° = æ­£å‘ + åå‘ + è‡ªèº«(1)
      const total = positiveCount + negativeCount + 1;
      if (total >= this.config.winCondition) {
        return true;
      }
    }

    return false;
  }

  /**
   * æ£€æŸ¥æ£‹ç›˜æ˜¯å¦å·²æ»¡ï¼ˆå¹³å±€æ¡ä»¶ï¼‰
   */
  isBoardFull(board: PieceType[][]): boolean {
    for (let row = 0; row < this.config.boardSize; row++) {
      for (let col = 0; col < this.config.boardSize; col++) {
        if (board[row][col] === PieceType.EMPTY) {
          return false;
        }
      }
    }
    return true;
  }

  /**
   * æ ¹æ®è½å­åçš„çŠ¶æ€åˆ¤æ–­æ¸¸æˆç»“æœ
   * @param board æ£‹ç›˜çŠ¶æ€
   * @param lastRow æœ€åè½å­è¡Œ
   * @param lastCol æœ€åè½å­åˆ—
   * @param currentPiece å½“å‰è½å­çš„æ£‹å­ç±»å‹
   */
  determineGameStatus(
    board: PieceType[][],
    lastRow: number,
    lastCol: number,
    currentPiece: PieceType
  ): GameStatus {
    // æ£€æŸ¥æ˜¯å¦è·èƒœ
    if (this.checkWin(board, lastRow, lastCol)) {
      return currentPiece === PieceType.BLACK ? GameStatus.BLACK_WIN : GameStatus.WHITE_WIN;
    }

    // æ£€æŸ¥æ˜¯å¦å¹³å±€
    if (this.isBoardFull(board)) {
      return GameStatus.DRAW;
    }

    // æ¸¸æˆç»§ç»­
    return GameStatus.PLAYING;
  }

===============================================================================
ç¬¬19é¡µ
===============================================================================

  /**
   * è·å–å¯¹æ‰‹æ£‹å­ç±»å‹
   */
  getOpponent(piece: PieceType): PieceType {
    return piece === PieceType.BLACK ? PieceType.WHITE : PieceType.BLACK;
  }

  /**
   * è·å–é…ç½®
   */
  getConfig(): GameConfig {
    return this.config;
  }
}

===============================================================================
ç¬¬20é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/model/GameState.ets
æ–‡ä»¶è¯´æ˜ï¼šäº”å­æ£‹æ¸¸æˆçŠ¶æ€ç®¡ç†æ¨¡å—ï¼Œç®¡ç†æ£‹ç›˜çŠ¶æ€ã€è½å­è®°å½•ã€æ‚”æ£‹ç­‰åŠŸèƒ½
-------------------------------------------------------------------------------

/**
 * äº”å­æ£‹æ¸¸æˆçŠ¶æ€ç®¡ç†æ¨¡å—
 * ç®¡ç†æ£‹ç›˜çŠ¶æ€ã€è½å­è®°å½•ã€æ‚”æ£‹ç­‰åŠŸèƒ½
 */

import { PieceType, GameStatus, MoveRecord, GameConfig, DEFAULT_CONFIG } from './GameTypes';
import { GameLogic } from './GameLogic';

/**
 * æ¸¸æˆçŠ¶æ€ç®¡ç†ç±»
 * è´Ÿè´£ç»´æŠ¤æ¸¸æˆçŠ¶æ€ã€å¤„ç†è½å­ã€æ‚”æ£‹ç­‰æ“ä½œ
 */
export class GameState {
  private board: PieceType[][];
  private currentPlayer: PieceType;
  private gameStatus: GameStatus;
  private moveHistory: MoveRecord[];
  private undoCount: number;
  private logic: GameLogic;
  private config: GameConfig;

  constructor(config: GameConfig = DEFAULT_CONFIG) {
    this.config = config;
    this.logic = new GameLogic(config);
    this.board = [];
    this.moveHistory = [];
    this.currentPlayer = PieceType.BLACK;
    this.gameStatus = GameStatus.PLAYING;
    this.undoCount = 0;
    this.initBoard();
  }

  /**
   * åˆå§‹åŒ–æ£‹ç›˜
   */
  private initBoard(): void {
    this.board = [];
    for (let i = 0; i < this.config.boardSize; i++) {
      const row: PieceType[] = [];
      for (let j = 0; j < this.config.boardSize; j++) {
        row.push(PieceType.EMPTY);
      }
      this.board.push(row);
    }
  }

===============================================================================
ç¬¬21é¡µ
===============================================================================

  /**
   * é‡ç½®æ¸¸æˆ
   */
  reset(): void {
    this.initBoard();
    this.moveHistory = [];
    this.currentPlayer = PieceType.BLACK;
    this.gameStatus = GameStatus.PLAYING;
    this.undoCount = 0;
  }

  /**
   * è½å­æ“ä½œ
   * @param row è¡Œç´¢å¼•
   * @param col åˆ—ç´¢å¼•
   * @returns æ˜¯å¦æˆåŠŸè½å­
   */
  placePiece(row: number, col: number): boolean {
    // æ¸¸æˆå·²ç»“æŸï¼Œä¸èƒ½è½å­
    if (this.gameStatus !== GameStatus.PLAYING) {
      return false;
    }

    // æ£€æŸ¥æ˜¯å¦å¯ä»¥è½å­
    if (!this.logic.canPlacePiece(this.board, row, col)) {
      return false;
    }

    // è½å­
    this.board[row][col] = this.currentPlayer;

    // è®°å½•è½å­å†å²
    const record: MoveRecord = {
      row: row,
      col: col,
      piece: this.currentPlayer,
      timestamp: Date.now()
    };
    this.moveHistory.push(record);

    // åˆ¤æ–­æ¸¸æˆçŠ¶æ€
    this.gameStatus = this.logic.determineGameStatus(
      this.board, row, col, this.currentPlayer
    );

    // åˆ‡æ¢ç©å®¶
    if (this.gameStatus === GameStatus.PLAYING) {
      this.currentPlayer = this.logic.getOpponent(this.currentPlayer);
    }

    return true;
  }

===============================================================================
ç¬¬22é¡µ
===============================================================================

  /**
   * æ‚”æ£‹æ“ä½œ
   * @returns æ˜¯å¦æˆåŠŸæ‚”æ£‹
   */
  undo(): boolean {
    // æ£€æŸ¥æ‚”æ£‹æ¬¡æ•°é™åˆ¶
    if (this.config.undoLimit >= 0 && this.undoCount >= this.config.undoLimit) {
      return false;
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰å†å²è®°å½•
    if (this.moveHistory.length === 0) {
      return false;
    }

    // æ’¤é”€æœ€åä¸€æ­¥
    const lastMove = this.moveHistory.pop();
    if (lastMove) {
      this.board[lastMove.row][lastMove.col] = PieceType.EMPTY;
      this.currentPlayer = lastMove.piece;
      this.gameStatus = GameStatus.PLAYING;
      this.undoCount++;
      return true;
    }

    return false;
  }

  /**
   * è·å–æ£‹ç›˜çŠ¶æ€
   */
  getBoard(): PieceType[][] {
    return this.board;
  }

  /**
   * è·å–æŒ‡å®šä½ç½®çš„æ£‹å­
   */
  getPiece(row: number, col: number): PieceType {
    if (this.logic.isValidPosition(row, col)) {
      return this.board[row][col];
    }
    return PieceType.EMPTY;
  }

  /**
   * è·å–å½“å‰ç©å®¶
   */
  getCurrentPlayer(): PieceType {
    return this.currentPlayer;
  }

===============================================================================
ç¬¬23é¡µ
===============================================================================

  /**
   * è·å–æ¸¸æˆçŠ¶æ€
   */
  getGameStatus(): GameStatus {
    return this.gameStatus;
  }

  /**
   * è·å–è½å­å†å²
   */
  getMoveHistory(): MoveRecord[] {
    return this.moveHistory;
  }

  /**
   * è·å–æœ€åä¸€æ­¥è½å­
   */
  getLastMove(): MoveRecord | null {
    if (this.moveHistory.length > 0) {
      return this.moveHistory[this.moveHistory.length - 1];
    }
    return null;
  }

  /**
   * è·å–å‰©ä½™æ‚”æ£‹æ¬¡æ•°
   */
  getRemainingUndos(): number {
    if (this.config.undoLimit < 0) {
      return -1; // æ— é™åˆ¶
    }
    return Math.max(0, this.config.undoLimit - this.undoCount);
  }

  /**
   * è·å–é…ç½®
   */
  getConfig(): GameConfig {
    return this.config;
  }

  /**
   * è·å–æ£‹ç›˜å¤§å°
   */
  getBoardSize(): number {
    return this.config.boardSize;
  }

  /**
   * æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
   */
  isGameOver(): boolean {
    return this.gameStatus !== GameStatus.PLAYING;
  }

===============================================================================
ç¬¬24é¡µ
===============================================================================

  /**
   * è·å–æ€»æ­¥æ•°
   */
  getTotalMoves(): number {
    return this.moveHistory.length;
  }
}

===============================================================================
ç¬¬25é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/model/GameTypes.ets
æ–‡ä»¶è¯´æ˜ï¼šäº”å­æ£‹æ¸¸æˆç±»å‹å®šä¹‰æ¨¡å—ï¼Œå®šä¹‰æ£‹å­ç±»å‹ã€æ¸¸æˆçŠ¶æ€ã€è½å­è®°å½•ç­‰æ ¸å¿ƒæ•°æ®ç»“æ„
-------------------------------------------------------------------------------

/**
 * äº”å­æ£‹æ¸¸æˆç±»å‹å®šä¹‰æ¨¡å—
 * å®šä¹‰æ£‹å­ç±»å‹ã€æ¸¸æˆçŠ¶æ€ã€è½å­è®°å½•ç­‰æ ¸å¿ƒæ•°æ®ç»“æ„
 */

/**
 * æ£‹å­ç±»å‹æšä¸¾
 */
export enum PieceType {
  EMPTY = 0,   // ç©ºä½
  BLACK = 1,   // é»‘å­
  WHITE = 2    // ç™½å­
}

/**
 * æ¸¸æˆçŠ¶æ€æšä¸¾
 */
export enum GameStatus {
  PLAYING = 0,     // æ¸¸æˆè¿›è¡Œä¸­
  BLACK_WIN = 1,   // é»‘æ–¹è·èƒœ
  WHITE_WIN = 2,   // ç™½æ–¹è·èƒœ
  DRAW = 3         // å¹³å±€
}

/**
 * è½å­è®°å½•æ¥å£
 */
export interface MoveRecord {
  row: number;          // è¡Œç´¢å¼• (0-based)
  col: number;          // åˆ—ç´¢å¼• (0-based)
  piece: PieceType;     // æ£‹å­ç±»å‹
  timestamp: number;    // æ—¶é—´æˆ³
}

/**
 * æ¸¸æˆé…ç½®æ¥å£
 */
export interface GameConfig {
  boardSize: number;      // æ£‹ç›˜å°ºå¯¸ (é»˜è®¤15)
  winCondition: number;   // èƒœåˆ©æ¡ä»¶ - è¿å­æ•°é‡ (é»˜è®¤5)
  undoLimit: number;      // æ‚”æ£‹æ¬¡æ•°é™åˆ¶ (-1è¡¨ç¤ºæ— é™åˆ¶)
}

===============================================================================
ç¬¬26é¡µ
===============================================================================

/**
 * æ£‹ç›˜ä½ç½®æ¥å£
 */
export interface Position {
  row: number;
  col: number;
}

/**
 * æ–¹å‘å‘é‡ - ç”¨äºèƒœè´Ÿåˆ¤å®š
 * 4ä¸ªæ–¹å‘ï¼šæ°´å¹³ã€å‚ç›´ã€å·¦ä¸Š-å³ä¸‹å¯¹è§’çº¿ã€å³ä¸Š-å·¦ä¸‹å¯¹è§’çº¿
 */
export const DIRECTIONS: Position[] = [
  { row: 0, col: 1 },   // æ°´å¹³
  { row: 1, col: 0 },   // å‚ç›´
  { row: 1, col: 1 },   // å·¦ä¸Š-å³ä¸‹å¯¹è§’çº¿
  { row: 1, col: -1 }   // å³ä¸Š-å·¦ä¸‹å¯¹è§’çº¿
];

/**
 * é»˜è®¤æ¸¸æˆé…ç½® - 15x15æ ‡å‡†æ£‹ç›˜
 */
export const DEFAULT_CONFIG: GameConfig = {
  boardSize: 15,
  winCondition: 5,
  undoLimit: -1
};

/**
 * 30x30å¤§æ£‹ç›˜é…ç½®
 */
export const CONFIG_30X30: GameConfig = {
  boardSize: 30,
  winCondition: 5,
  undoLimit: -1
};

/**
 * æ£‹ç›˜å°ºå¯¸é€‰é¡¹
 */
export const BOARD_SIZE_OPTIONS: number[] = [15, 30];

===============================================================================
ç¬¬27é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/model/GameConstants.ets
æ–‡ä»¶è¯´æ˜ï¼šæ¸¸æˆå¸¸é‡é…ç½®ï¼ŒåŒ…å«ç‰ˆæœ¬ä¿¡æ¯ã€æ˜Ÿä½é…ç½®ã€ç¼©æ”¾å‚æ•°ç­‰å¸¸é‡
-------------------------------------------------------------------------------

/**
 * æ¸¸æˆå¸¸é‡é…ç½®
 * åŒ…å«ç‰ˆæœ¬ä¿¡æ¯ã€æ˜Ÿä½é…ç½®ã€ç¼©æ”¾å‚æ•°ç­‰å¸¸é‡
 */

/**
 * åº”ç”¨ç‰ˆæœ¬ä¿¡æ¯æ¥å£
 */
interface AppInfoType {
  version: string;
  author: string;
  email: string;
  buildDate: string;
}

/**
 * æ£‹ç›˜å°ºå¯¸é…ç½®æ¥å£
 */
interface BoardSizeConfig {
  cellSize: number;
  pieceSize: number;
}

/**
 * 30è·¯æ£‹ç›˜é…ç½®æ¥å£
 */
interface Board30Config {
  baseCellSize: number;
  basePieceSize: number;
}

/**
 * æ£‹ç›˜å¸ƒå±€é…ç½®æ¥å£
 */
interface BoardLayoutType {
  padding: number;
  board15: BoardSizeConfig;
  board30: Board30Config;
}

/**
 * ç¼©æ”¾é…ç½®é¡¹æ¥å£
 */
interface ScaleConfigItem {
  min: number;
  max: number;
  defaultValue: number;
}

===============================================================================
ç¬¬28é¡µ
===============================================================================

/**
 * ç¼©æ”¾é…ç½®æ¥å£
 */
interface ScaleConfigType {
  scale15: ScaleConfigItem;
  scale30: ScaleConfigItem;
}

/**
 * åº”ç”¨ç‰ˆæœ¬ä¿¡æ¯
 */
export const APP_INFO: AppInfoType = {
  version: '1.0.0',
  author: 'é™ˆäº‘äº®',
  email: '676814828@qq.com',
  buildDate: '2025.12'
};

/**
 * æ£‹ç›˜å¸ƒå±€é…ç½®
 */
export const BOARD_LAYOUT: BoardLayoutType = {
  padding: 15,
  board15: {
    cellSize: 22,
    pieceSize: 20
  },
  board30: {
    baseCellSize: 12,
    basePieceSize: 10
  }
};

/**
 * ç¼©æ”¾é…ç½®
 */
export const SCALE_CONFIG: ScaleConfigType = {
  scale15: {
    min: 1.0,
    max: 2.0,
    defaultValue: 2.0
  },
  scale30: {
    min: 1.0,
    max: 4.0,
    defaultValue: 4.0
  }
};

/**
 * 15è·¯æ£‹ç›˜æ˜Ÿä½åæ ‡
 */
export const STAR_POINTS_15: number[][] = [
  [3, 3], [3, 7], [3, 11],
  [7, 3], [7, 7], [7, 11],
  [11, 3], [11, 7], [11, 11]
];

===============================================================================
ç¬¬29é¡µ
===============================================================================

/**
 * 30è·¯æ£‹ç›˜æ˜Ÿä½åæ ‡
 */
export const STAR_POINTS_30: number[][] = [
  [3, 3], [3, 15], [3, 26],
  [15, 3], [15, 15], [15, 26],
  [26, 3], [26, 15], [26, 26]
];

/**
 * åˆ¤æ–­æŒ‡å®šä½ç½®æ˜¯å¦ä¸ºæ˜Ÿä½
 */
export function isStarPoint(row: number, col: number, boardSize: number): boolean {
  const starPoints = boardSize === 30 ? STAR_POINTS_30 : STAR_POINTS_15;
  for (let i = 0; i < starPoints.length; i++) {
    if (starPoints[i][0] === row && starPoints[i][1] === col) {
      return true;
    }
  }
  return false;
}

/**
 * è·å–æ£‹ç›˜çš„ç¼©æ”¾é…ç½®
 */
export function getScaleConfig(boardSize: number): ScaleConfigItem {
  return boardSize === 30 ? SCALE_CONFIG.scale30 : SCALE_CONFIG.scale15;
}

/**
 * è·å–ç´¢å¼•æ•°ç»„
 */
export function getIndices(size: number): number[] {
  const indices: number[] = [];
  for (let i = 0; i < size; i++) {
    indices.push(i);
  }
  return indices;
}

===============================================================================
ç¬¬30é¡µ
===============================================================================
æ–‡ä»¶è·¯å¾„ï¼šentry/src/main/ets/components/BoardCell.ets
æ–‡ä»¶è¯´æ˜ï¼šæ£‹ç›˜å•å…ƒæ ¼ç»„ä»¶ï¼Œè´Ÿè´£æ¸²æŸ“å•ä¸ªæ ¼å­çš„ç½‘æ ¼çº¿ã€æ˜Ÿä½å’Œæ£‹å­
-------------------------------------------------------------------------------

/**
 * æ£‹ç›˜å•å…ƒæ ¼ç»„ä»¶
 * è´Ÿè´£æ¸²æŸ“å•ä¸ªæ ¼å­çš„ç½‘æ ¼çº¿ã€æ˜Ÿä½å’Œæ£‹å­
 */

import { PieceType } from '../model/GameTypes';
import { isStarPoint } from '../model/GameConstants';

/**
 * æ£‹ç›˜å•å…ƒæ ¼å±æ€§
 */
interface BoardCellProps {
  row: number;
  col: number;
  boardSize: number;
  cellSize: number;
  pieceSize: number;
  pieceType: PieceType;
  isLastMove: boolean;
  onCellClick: (row: number, col: number) => void;
}

/**
 * æ£‹ç›˜å•å…ƒæ ¼ç»„ä»¶
 */
@Component
export struct BoardCell {
  @Prop row: number = 0;
  @Prop col: number = 0;
  @Prop boardSize: number = 15;
  @Prop cellSize: number = 22;
  @Prop pieceSize: number = 20;
  @Prop pieceType: PieceType = PieceType.EMPTY;
  @Prop isLastMove: boolean = false;
  onCellClick: (row: number, col: number) => void = () => {};

  build() {
    Stack() {
      // ç»˜åˆ¶ç½‘æ ¼çº¿
      Canvas(new CanvasRenderingContext2D(new RenderingContextSettings(true)))
        .width(this.cellSize)
        .height(this.cellSize)
        .onReady(() => { })

      // ç½‘æ ¼çº¿èƒŒæ™¯ - æ°´å¹³çº¿
      Column() {
        if (this.row > 0 || this.row < this.boardSize - 1) {
          Line()
            .width(this.col === 0 ? this.cellSize / 2 : (this.col === this.boardSize - 1 ? this.cellSize / 2 : this.cellSize))

===============================================================================
                            æºä»£ç å‰30é¡µç»“æŸ
===============================================================================
